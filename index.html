<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <title>Scatterpot</title>
    <script type="text/javascript" src="https://d3js.org/d3.v5.min.js"></script>
    <link rel="stylesheet" type="text/css" href="styles.css">
    <style></style>
</head>

<body>
    <div id="container" class="svg-container"></div>
    <script>
        //------------------------1. PREPARATION------------------------//

        //-----------------------------SVG------------------------------//
        const margin = ({ top: 10, right: 10, bottom: 20, left: 40 });
        const width = 460;
        const height = 400;
        const padding = 5;
        const adj = 30;
        // we are appending SVG first
        const svg = d3.select("div#container").append("svg")
            .attr("preserveAspectRatio", "xMinYMin meet")
            .attr("viewBox", "-"
                + adj + " -"
                + adj + " "
                + (width + adj * 3) + " "
                + (height + adj * 3))
            .style("padding", padding)
            .style("margin", margin)
            .classed("svg-content", true);

        var tooltip = tooltip = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        const color = d3.scaleOrdinal(d3.schemeCategory10);

        //-----------------------------DATA-----------------------------//
        const dataset = d3.csv("cereal.csv");
        dataset.then(data => {
            data.forEach(function (d) { // string to number 
                d.Calories = +d.Calories;
                d["Protein (g)"] = +d["Protein (g)"];
            });
            //----------------------------SCALES----------------------------//

            const xScale = d3.scaleLinear()
                .domain([d3.min(data, d => d.Calories - 2), d3.max(data, d => d.Calories + 1)])
                .range([0, width])

            const yScale = d3.scaleLinear()
                .domain([d3.min(data, d => d["Protein (g)"] - 1), d3.max(data, d => d["Protein (g)"] + 1)])
                .rangeRound([height - margin.bottom, margin.top])
            //-----------------------------AXES-----------------------------//
            const yaxis = d3.axisLeft()
                .ticks()
                .scale(yScale);

            const xaxis = d3.axisBottom()
                .scale(xScale)
            //---------------------------TOOLTIP----------------------------//
            //-------------------------2. DRAWING---------------------------//
            //-----------------------------AXES-----------------------------//
            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0" + "," + (height - margin.bottom) + ")")
                .call(xaxis)
                .append("text")
                .attr("class", "label")
                .attr("x", width)
                .attr("y", -6)
                .style("text-anchor", "end")
                .text("Calories");

            svg.append("g")
                .attr("class", "y axis")
                .call(yaxis)
                .append("text")
                .attr("class", "label")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("Protein (g)");

            //----------------------------PLOTS-----------------------------//

            svg.selectAll(".dot")
                .data(data)
                .enter().append("circle")
                .attr("class", "dot")
                .attr("r", 3.5)
                .attr("cx", d => xScale(d.Calories))
                .attr("cy", d => yScale(d["Protein (g)"]))
                .style("fill", function (d) { return color(d.Manufacturer) })
                .on("mouseover", function (d) {
                    tooltip.transition()
                        .duration(200)
                        .style("opacity", .9);
                    tooltip.html(d["Cereal Name"] + "<br/> (" + d.Calories
                        + ", " + d["Protein (g)"] + ")")
                        .style("left", (d3.event.pageX + 5) + "px")
                        .style("top", (d3.event.pageY - 28) + "px");
                })
                .on("mouseout", function (d) {
                    tooltip.transition()
                        .duration(500)
                        .style("opacity", 0);
                });

            //----------------------------GRIDS-----------------------------//
            svg.append("g")
                .attr("stroke", "currentColor")
                .attr("stroke-opacity", 0.1)
                .call(g => g.append("g")
                    .selectAll("line")
                    .data(xScale.ticks())
                    .join("line")
                    .attr("x1", d => xScale(d))
                    .attr("x2", d => xScale(d))
                    .attr("y1", margin.top)
                    .attr("y2", height - margin.bottom))
                .call(g => g.append("g")
                    .selectAll("line")
                    .data(yScale.ticks())
                    .join("line")
                    .attr("y1", d => yScale(d))
                    .attr("y2", d => yScale(d))
                    .attr("x1", 0)
                    .attr("x2", width));

            //----------------------------legend-----------------------------//

            //---------------------------POINTS-----------------------------// 

            //---------------------------EVENTS-----------------------------//
        })
    </script>
</body>